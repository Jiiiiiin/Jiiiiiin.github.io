<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Shell Script 基础学习 - 赵津的笔记</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="赵津" /><meta name="description" content="Shell Script 基础相关记录
" /><meta name="keywords" content="赵津, Hugo, theme, even" />






<meta name="generator" content="Hugo 0.64.1 with theme even" />


<link rel="canonical" href="http://localhost:1313/post/linux/linux-netman-shell-script-base-note/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.fce678a23da9bc8674187e699d2657dfa3b0032cb9001b70f2ec79b8452ffac2.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Shell Script 基础学习" />
<meta property="og:description" content="Shell Script 基础相关记录" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/post/linux/linux-netman-shell-script-base-note/" />
<meta property="article:published_time" content="2020-02-15T22:53:13+08:00" />
<meta property="article:modified_time" content="2020-05-24T16:18:02+08:00" />
<meta itemprop="name" content="Shell Script 基础学习">
<meta itemprop="description" content="Shell Script 基础相关记录">
<meta itemprop="datePublished" content="2020-02-15T22:53:13&#43;08:00" />
<meta itemprop="dateModified" content="2020-05-24T16:18:02&#43;08:00" />
<meta itemprop="wordCount" content="8997">



<meta itemprop="keywords" content="linux,shell-script," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Shell Script 基础学习"/>
<meta name="twitter:description" content="Shell Script 基础相关记录"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">津</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">津</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Shell Script 基础学习</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-02-15 </span>
        <div class="post-category">
            <a href="/categories/shell-script/"> shell-script </a>
            </div>
          <span class="more-meta"> 约 8997 字 </span>
          <span class="more-meta"> 预计阅读 18 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#shell-type">Shell Type</a>
      <ul>
        <li><a href="#是否是-login-shell-类型之分">是否是 Login Shell 类型之分</a></li>
        <li><a href="#是否是互动-shell-之分">是否是互动 Shell 之分</a></li>
      </ul>
    </li>
    <li><a href="#shell-invocation">Shell Invocation</a></li>
    <li><a href="#shell中可以执行的命令类型">Shell中可以执行的命令类型</a></li>
    <li><a href="#shell-如何找到待执行的命令">Shell 如何找到待执行的命令</a></li>
    <li><a href="#指令查询方法">指令查询方法</a></li>
    <li><a href="#变量设置-variable-setting">变量设置 Variable Setting</a>
      <ul>
        <li><a href="#全局变量">全局变量</a></li>
        <li><a href="#局部变量">局部变量</a></li>
        <li><a href="#declare-定义变量">declare 定义变量</a></li>
      </ul>
    </li>
    <li><a href="#变量替换-variable-substitution">变量替换 Variable Substitution</a>
      <ul>
        <li><a href="#查看一个变量内容-view-a-variable-value">查看一个变量内容 View a variable value</a></li>
        <li><a href="#变量值的扩充-value-expansion">变量值的扩充 Value Expansion</a></li>
      </ul>
    </li>
    <li><a href="#命令的输出-the-export-command">命令的输出 The export command</a>
      <ul>
        <li><a href="#查看环境变量-viewing-environment-variable">查看环境变量 Viewing Environment Variable</a></li>
        <li><a href="#变量撤销-variable-revocation">变量撤销 Variable Revocation</a></li>
        <li><a href="#使用-read-指令定义变量-using-read">使用 read 指令定义变量 Using read</a></li>
      </ul>
    </li>
    <li><a href="#别名-command-alias">别名 Command Alias</a></li>
    <li><a href="#进程的继承关系-process-hierarch">进程的继承关系 Process Hierarch</a>
      <ul>
        <li><a href="#进程返回值">进程返回值</a></li>
      </ul>
    </li>
    <li><a href="#shell-script定义">Shell Script定义</a>
      <ul>
        <li><a href="#脚本运行方式">脚本运行方式</a></li>
        <li><a href="#source-命令来跑shell脚本-source-runing">Source 命令来跑shell脚本 Source Runing</a></li>
        <li><a href="#exec命令来跑-shell-脚本-exec-running">Exec命令来跑 shell 脚本 Exec Running</a></li>
        <li><a href="#选择如何执行你的shell脚本">选择如何执行你的shell脚本</a></li>
        <li><a href="#示例">示例</a></li>
        <li><a href="#排列成一行执行多行命令-sequence-running">排列成一行执行多行命令 Sequence Running</a></li>
      </ul>
    </li>
    <li><a href="#命令行群组-command-grouping">命令行群组 Command Grouping</a></li>
    <li><a href="#具名的群组-named-command-group">具名的群组 Named Command Group</a></li>
    <li><a href="#命令替换-command-substitution">命令替换 Command Substitution</a>
      <ul>
        <li><a href="#其他变量替换-other-variable-substitution">其他变量替换 Other Variable Substitution</a></li>
      </ul>
    </li>
    <li><a href="#数组-array-setting">数组 Array Setting</a></li>
    <li><a href="#计算-arithmetic-expansion">计算 Arithmetic Expansion</a>
      <ul>
        <li><a href="#bc指令">bc指令</a></li>
        <li><a href="#expr-指令">expr 指令</a></li>
        <li><a href="#运算符-arithmetic-operation">运算符 Arithmetic Operation</a></li>
      </ul>
    </li>
    <li><a href="#脚本参数-script-parameter">脚本参数 Script Parameter</a>
      <ul>
        <li><a href="#参数取值-gathering-parameters">参数取值 Gathering Parameters</a></li>
      </ul>
    </li>
    <li><a href="#参数替换-parameter-substitution">参数替换 Parameter Substitution</a></li>
    <li><a href="#参数变化-parameter-shifting">参数变化 Parameter Shifting</a></li>
    <li><a href="#重置参数-set-command">重置参数 Set Command</a></li>
    <li><a href="#脚本中的返回值-return-value-rv">脚本中的返回值 Return Value (RV)</a></li>
    <li><a href="#条件返回-conditional-running">条件返回 Conditional Running</a></li>
    <li><a href="#test-condition">Test Condition</a>
      <ul>
        <li><a href="#test-expression">Test Expression</a></li>
        <li><a href="#string-expression">String Expression</a></li>
        <li><a href="#integer-expression">Integer Expression</a></li>
        <li><a href="#file-expression">File expression</a></li>
      </ul>
    </li>
    <li><a href="#条件分之判断-the-if-then-statement">条件分之判断 The if-then Statement</a>
      <ul>
        <li><a href="#using-command-group">Using Command Group</a></li>
        <li><a href="#多轮条件判断-multiple-conditions-elif">多轮条件判断 Multiple Conditions (elif)</a></li>
      </ul>
    </li>
    <li><a href="#case判断语法-run-by-case">Case判断语法 Run By case</a></li>
    <li><a href="#循环语句-loop-statement">循环语句 Loop Statement</a>
      <ul>
        <li><a href="#the-for-loop">The for Loop</a></li>
        <li><a href="#the-while-loop">The while Loop</a></li>
        <li><a href="#break">break</a></li>
      </ul>
    </li>
    <li><a href="#函数-function">函数 Function</a></li>
    <li><a href="#调试脚本">调试脚本</a></li>
    <li><a href="#示例脚本">示例脚本</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Shell Script 基础相关记录</p>
<!-- raw HTML omitted -->
<ul>
<li><a href="#shell-type">Shell Type</a>
<ul>
<li><a href="#%E6%98%AF%E5%90%A6%E6%98%AF-login-shell-%E7%B1%BB%E5%9E%8B%E4%B9%8B%E5%88%86">是否是 Login Shell 类型之分</a></li>
<li><a href="#%E6%98%AF%E5%90%A6%E6%98%AF%E4%BA%92%E5%8A%A8-shell-%E4%B9%8B%E5%88%86">是否是互动 Shell 之分</a></li>
</ul>
</li>
<li><a href="#shell-invocation">Shell Invocation</a></li>
<li><a href="#shell%E4%B8%AD%E5%8F%AF%E4%BB%A5%E6%89%A7%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4%E7%B1%BB%E5%9E%8B">Shell中可以执行的命令类型</a></li>
<li><a href="#shell-%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E5%BE%85%E6%89%A7%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4">Shell 如何找到待执行的命令</a></li>
<li><a href="#%E6%8C%87%E4%BB%A4%E6%9F%A5%E8%AF%A2%E6%96%B9%E6%B3%95">指令查询方法</a></li>
<li><a href="#%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE-variable-setting">变量设置 Variable Setting</a>
<ul>
<li><a href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">全局变量</a></li>
<li><a href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F">局部变量</a></li>
<li><a href="#declare-%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F">declare 定义变量</a></li>
</ul>
</li>
<li><a href="#%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2-variable-substitution">变量替换 Variable Substitution</a>
<ul>
<li><a href="#%E6%9F%A5%E7%9C%8B%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%E5%86%85%E5%AE%B9-view-a-variable-value">查看一个变量内容 View a variable value</a></li>
<li><a href="#%E5%8F%98%E9%87%8F%E5%80%BC%E7%9A%84%E6%89%A9%E5%85%85-value-expansion">变量值的扩充 Value Expansion</a></li>
</ul>
</li>
<li><a href="#%E5%91%BD%E4%BB%A4%E7%9A%84%E8%BE%93%E5%87%BA-the-export-command">命令的输出 The export command</a>
<ul>
<li><a href="#%E6%9F%A5%E7%9C%8B%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-viewing-environment-variable">查看环境变量 Viewing Environment Variable</a></li>
<li><a href="#%E5%8F%98%E9%87%8F%E6%92%A4%E9%94%80-variable-revocation">变量撤销 Variable Revocation</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-read-%E6%8C%87%E4%BB%A4%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F-using-read">使用 read 指令定义变量 Using read</a></li>
</ul>
</li>
<li><a href="#%E5%88%AB%E5%90%8D-command-alias">别名 Command Alias</a></li>
<li><a href="#%E8%BF%9B%E7%A8%8B%E7%9A%84%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB-process-hierarch">进程的继承关系 Process Hierarch</a>
<ul>
<li><a href="#%E8%BF%9B%E7%A8%8B%E8%BF%94%E5%9B%9E%E5%80%BC">进程返回值</a></li>
</ul>
</li>
<li><a href="#shell-script%E5%AE%9A%E4%B9%89">Shell Script定义</a>
<ul>
<li><a href="#%E8%84%9A%E6%9C%AC%E8%BF%90%E8%A1%8C%E6%96%B9%E5%BC%8F">脚本运行方式</a></li>
<li><a href="#source-%E5%91%BD%E4%BB%A4%E6%9D%A5%E8%B7%91shell%E8%84%9A%E6%9C%AC-source-runing">Source 命令来跑shell脚本 Source Runing</a></li>
<li><a href="#exec%E5%91%BD%E4%BB%A4%E6%9D%A5%E8%B7%91-shell-%E8%84%9A%E6%9C%AC-exec-running">Exec命令来跑 shell 脚本 Exec Running</a></li>
<li><a href="#%E9%80%89%E6%8B%A9%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E4%BD%A0%E7%9A%84shell%E8%84%9A%E6%9C%AC">选择如何执行你的shell脚本</a></li>
<li><a href="#%E7%A4%BA%E4%BE%8B">示例</a></li>
<li><a href="#%E6%8E%92%E5%88%97%E6%88%90%E4%B8%80%E8%A1%8C%E6%89%A7%E8%A1%8C%E5%A4%9A%E8%A1%8C%E5%91%BD%E4%BB%A4-sequence-running">排列成一行执行多行命令 Sequence Running</a></li>
</ul>
</li>
<li><a href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BE%A4%E7%BB%84-command-grouping">命令行群组 Command Grouping</a></li>
<li><a href="#%E5%85%B7%E5%90%8D%E7%9A%84%E7%BE%A4%E7%BB%84-named-command-group">具名的群组 Named Command Group</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%9B%BF%E6%8D%A2-command-substitution">命令替换 Command Substitution</a>
<ul>
<li><a href="#%E5%85%B6%E4%BB%96%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2-other-variable-substitution">其他变量替换 Other Variable Substitution</a>
<ul>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%8F%98%E9%87%8F%E9%95%BF%E5%BA%A6">获取变量长度</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%AD%90%E4%B8%B2%E5%9C%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E7%B4%A2%E5%BC%95%E4%BD%8D%E7%BD%AE">获取子串在字符串中的索引位置</a></li>
<li><a href="#%E5%8E%BB%E5%A4%B4%E5%8E%BB%E5%B0%BE">去头去尾</a></li>
<li><a href="#%E6%88%AA%E5%8F%96%E5%AD%90%E4%B8%B2">截取子串</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E9%95%BF%E5%BA%A6%E7%9A%84%E5%8F%98%E9%87%8F%E5%80%BC">获取指定长度的变量值</a></li>
<li><a href="#%E5%8F%98%E9%87%8F%E5%80%BC%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9%E6%9B%BF%E6%8D%A2">变量值输出内容替换</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%95%B0%E7%BB%84-array-setting">数组 Array Setting</a></li>
<li><a href="#%E8%AE%A1%E7%AE%97-arithmetic-expansion">计算 Arithmetic Expansion</a>
<ul>
<li><a href="#bc%E6%8C%87%E4%BB%A4">bc指令</a></li>
<li><a href="#expr-%E6%8C%87%E4%BB%A4">expr 指令</a></li>
<li><a href="#%E8%BF%90%E7%AE%97%E7%AC%A6-arithmetic-operation">运算符 Arithmetic Operation</a></li>
</ul>
</li>
<li><a href="#%E8%84%9A%E6%9C%AC%E5%8F%82%E6%95%B0-script-parameter">脚本参数 Script Parameter</a>
<ul>
<li><a href="#%E5%8F%82%E6%95%B0%E5%8F%96%E5%80%BC-gathering-parameters">参数取值 Gathering Parameters</a></li>
</ul>
</li>
<li><a href="#%E5%8F%82%E6%95%B0%E6%9B%BF%E6%8D%A2-parameter-substitution">参数替换 Parameter Substitution</a></li>
<li><a href="#%E5%8F%82%E6%95%B0%E5%8F%98%E5%8C%96-parameter-shifting">参数变化 Parameter Shifting</a></li>
<li><a href="#%E9%87%8D%E7%BD%AE%E5%8F%82%E6%95%B0-set-command">重置参数 Set Command</a></li>
<li><a href="#%E8%84%9A%E6%9C%AC%E4%B8%AD%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC-return-value-rv">脚本中的返回值 Return Value (RV)</a></li>
<li><a href="#%E6%9D%A1%E4%BB%B6%E8%BF%94%E5%9B%9E-conditional-running">条件返回 Conditional Running</a></li>
<li><a href="#test-condition">Test Condition</a>
<ul>
<li><a href="#test-expression">Test Expression</a></li>
<li><a href="#string-expression">String Expression</a>
<ul>
<li><a href="#%E4%BE%8B%E5%AD%90-test-example">例子 Test Example</a></li>
</ul>
</li>
<li><a href="#integer-expression">Integer Expression</a></li>
<li><a href="#file-expression">File expression</a></li>
</ul>
</li>
<li><a href="#%E6%9D%A1%E4%BB%B6%E5%88%86%E4%B9%8B%E5%88%A4%E6%96%AD-the-if-then-statement">条件分之判断 The if-then Statement</a>
<ul>
<li><a href="#using-command-group">Using Command Group</a></li>
<li><a href="#%E5%A4%9A%E8%BD%AE%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD-multiple-conditions-elif">多轮条件判断 Multiple Conditions (elif)</a></li>
</ul>
</li>
<li><a href="#case%E5%88%A4%E6%96%AD%E8%AF%AD%E6%B3%95-run-by-case">Case判断语法 Run By case</a></li>
<li><a href="#%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5-loop-statement">循环语句 Loop Statement</a>
<ul>
<li><a href="#the-for-loop">The for Loop</a></li>
<li><a href="#the-while-loop">The while Loop</a></li>
<li><a href="#break">break</a>
<ul>
<li><a href="#using-cont-inue-in-loop">Using cont inue In Loop</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%87%BD%E6%95%B0-function">函数 Function</a></li>
<li><a href="#%E8%B0%83%E8%AF%95%E8%84%9A%E6%9C%AC">调试脚本</a></li>
<li><a href="#%E7%A4%BA%E4%BE%8B%E8%84%9A%E6%9C%AC">示例脚本</a></li>
</ul>
<!-- raw HTML omitted -->
<h2 id="shell-type">Shell Type</h2>
<ul>
<li>
<p>Login Shell</p>
<ul>
<li>Local login via console</li>
<li>Terminal program</li>
<li>Remote login</li>
</ul>
</li>
<li>
<p>Interactive Shell</p>
<ul>
<li>With shell prompt</li>
<li>Typing commands manually</li>
</ul>
</li>
</ul>
<h3 id="是否是-login-shell-类型之分">是否是 Login Shell 类型之分</h3>
<ul>
<li>Login Shell 就是登录主机产生出来的 shell</li>
<li>其他的就是非 Login Shell</li>
</ul>
<h3 id="是否是互动-shell-之分">是否是互动 Shell 之分</h3>
<ul>
<li>存在 shell prompt 的或者不是</li>
<li>一般 shell script 都是非互动类型</li>
</ul>
<h2 id="shell-invocation">Shell Invocation</h2>
<p>shell 在启动的时候会执行一些预配置文件，根据 shell 的类型不同读取的设定内容也不同；</p>
<p>Login Shell</p>
<ul>
<li>
<p>/etc/profile</p>
</li>
<li>
<p>then one of following in order</p>
<ul>
<li>-/bash profile</li>
<li>-/bash login</li>
<li>-/profile</li>
</ul>
</li>
</ul>
<p>Interactive Shell</p>
<ul>
<li>
<p>/etc/bash.bashrc</p>
</li>
<li>
<p>-/ bashrc</p>
</li>
<li>
<p>login shell type</p>
</li>
</ul>
<p>etc 下面的这个配置必跑，下面的3个文件按照查找的优先级由上到下只会跑一个；</p>
<p>不同的发现版，这3个配置文件会稍有不同，Redhead 就是前两个；</p>
<p>其次，etc 下面的那个配置，是全局的，家目录中的某一个配置只是针对用户自己的；</p>
<p>用户的设定会覆盖全局的设定；</p>
<ul>
<li>互动式的 shell</li>
</ul>
<p>会在执行后面两个预设文档；</p>
<h2 id="shell中可以执行的命令类型">Shell中可以执行的命令类型</h2>
<p><img src="http://qiniu.jiiiiiin.cn/pSk3kv.png" alt="Text"></p>
<ul>
<li>可以使用 <code>compgen -[abcA] [function]</code>查询不同的可以执行的“命令”类型
<img src="http://qiniu.jiiiiiin.cn/AYGjiZ.png" alt="Text"></li>
</ul>
<blockquote>
<p><a href="https://www.youtube.com/watch?v=iMjkC8fO3VU&amp;list=PLSebY0Ugo-zdU_gqnSPj5rjrGUhIKh3aP">Basic of Linux shell Command</a></p>
</blockquote>
<h2 id="shell-如何找到待执行的命令">Shell 如何找到待执行的命令</h2>
<p><img src="http://qiniu.jiiiiiin.cn/SKxmqD.png" alt="Text"></p>
<ul>
<li>在PATH定义的目录中找到第一个可执行程序就会被使用</li>
<li><code>which cd</code></li>
</ul>
<h2 id="指令查询方法">指令查询方法</h2>
<p><img src="http://qiniu.jiiiiiin.cn/t7Wler.png" alt="Text"></p>
<h2 id="变量设置-variable-setting">变量设置 Variable Setting</h2>
<ul>
<li>
<p>Setting a variable:</p>
<p>name=value</p>
</li>
<li>
<p>Setting rules:</p>
<ul>
<li>No space</li>
<li>No number beginning</li>
<li>No $ in name</li>
<li>Case sensitive</li>
</ul>
</li>
</ul>
<p>如果没有 quoting 不能有任何 IFS；</p>
<p>value 部分可以使用$来进行变量的引用；</p>
<ul>
<li>常见错误</li>
</ul>
<p><code>A= B</code> shell 解析的时候会赋一个空值给 A，然后将 A 变量丢给 B 命令去跑；</p>
<h3 id="全局变量">全局变量</h3>
<ul>
<li>不做特殊声明， Shell中变量都是全局变量</li>
<li>Tips ：大型脚本程序中函数中慎用全局变量</li>
<li>在函数中声明的变量，如果函数被调用过，“ 之后 ”这个变量也会变成全局变量；</li>
</ul>
<h3 id="局部变量">局部变量</h3>
<ul>
<li>定义变量时，使用local关键字</li>
<li>函数内和外若存在同名变量，则函数内部变量覆盖外部变量</li>
</ul>
<h3 id="declare-定义变量">declare 定义变量</h3>
<p>declare命令和typeset命令两者等价</p>
<p>declare、typeset命令 都是用来定义变量类型的</p>
<p><img src="http://qiniu.jiiiiiin.cn/NYNwRT.png" alt="Text"></p>
<p>-f 可以显示系统中（系统默认就定义了一些）定义好的一些可用函数，包括函数体，而-F
就只显示函数名；</p>
<p><img src="http://qiniu.jiiiiiin.cn/PSY2ee.png" alt="Text"></p>
<p>shell 默认是以字符串来处理变量类型，所以需要使用 declare
来将一个变量声明成具体的类型；</p>
<h2 id="变量替换-variable-substitution">变量替换 Variable Substitution</h2>
<p>定义一个变量是为了在 shell 中去引用；</p>
<ul>
<li>Substitute then re-construct:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nv">A</span><span class="o">=</span>ls
$ <span class="nv">B</span><span class="o">=</span>la
$ <span class="nv">C</span><span class="o">=</span>/tmp
$ <span class="nv">$A</span> -<span class="nv">$B</span>  <span class="nv">$C</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Result:
<code>$ ls -la /tmp</code></li>
</ul>
<p>shell 在进行解析的时候，会先将变量替换得到一个<em>原始的命令内容</em> 之后再去执行转换后的原始命令；</p>
<p>而且这个替换过程是在按 Enter 之前就已经完成了；</p>
<h3 id="查看一个变量内容-view-a-variable-value">查看一个变量内容 View a variable value</h3>
<p>Using the echo command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">echo</span> <span class="nv">$A</span> -<span class="nv">$B</span> <span class="nv">$C</span>
ls -la /tmp
</code></pre></td></tr></table>
</div>
</div><p><em>echo 会将其 args 对到 STDOUT 上面</em>;</p>
<p>这样我们就很方便的查看一个变量的内容；</p>
<h3 id="变量值的扩充-value-expansion">变量值的扩充 Value Expansion</h3>
<ul>
<li>
<p>Using separator:</p>
<p>$ A=B:C: D</p>
<p>$ A=$A:E</p>
</li>
<li>
<p>Using {}:</p>
<p>$ A=BCD</p>
<p>$ A=${A}E</p>
</li>
<li>
<p>有分隔符号</p>
</li>
</ul>
<p>比如使用冒号作为分隔符，在进行扩充的时候只需要使用 $引用原有的变量内容，在使用冒号分割后面跟新的值；</p>
<p>如果需要向前扩充，可以将扩充内容放在引用之前；</p>
<ul>
<li>没有分隔符</li>
</ul>
<p>就在变量引用的时候使用括号来界定引用；</p>
<p>不加括号就会导致找不到引用；</p>
<p><em><strong>建议在 shell 脚本中都是用加上大括号的方式来进行变量的引用</strong></em></p>
<h2 id="命令的输出-the-export-command">命令的输出 The export command</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">. Purpose:
To set Environment Variable, inheritable in sub shells.
</code></pre></td></tr></table>
</div>
</div><p>linux 中进程是一棵树状结构，类似目录；</p>
<p>shell 中跑出来的进程，其父进程都是 shell；</p>
<p>shell 中定义的变量对于自己可见，对它的子进程是不可见的；</p>
<p>而这种变量就成为本地变量；</p>
<p>当然还有一种叫做环境变量，这种变量就会被子进程所继承，使用 export 命令就可以将一个本地变量升级成为一个环境变量；</p>
<p><code>export valiable_name</code> export 后面跟指定要输出到环境的变量名即可；</p>
<p>需要注意导出的环境变量只影响自己何其子进程；</p>
<p>另外如果在子进程修改了变量的值，不会影响父进程；</p>
<p>再就是如果中间进程修改了一个变量，那么其下的子进程拿到的就是其最近的父进程的变量值，而不是祖父的；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">Setting Environment Variable Using <span class="nb">export</span> command:
$ <span class="nv">A</span><span class="o">=</span>B
$ <span class="nb">export</span> A
Or
$ <span class="nb">export</span> <span class="nv">A</span><span class="o">=</span>B
Using <span class="nb">declare</span> command: $ <span class="nb">declare</span> 一x A
$ <span class="nv">A</span><span class="o">=</span>B
</code></pre></td></tr></table>
</div>
</div><p>可以升级一个本地变量也可以直接定义一个环境变量；</p>
<p>或者先使用 declare命令 <code>-i</code> 先说明一个环境变量，在后面在赋值；</p>
<p><img src="http://qiniu.jiiiiiin.cn/R5fAu0.jpg" alt="Text"></p>
<p>上图就是 export 一个变量前后对于不同进程（子进程)的影响；</p>
<h3 id="查看环境变量-viewing-environment-variable">查看环境变量 Viewing Environment Variable</h3>
<ul>
<li>Using env command: $ env</li>
<li>Using export command: $ export</li>
</ul>
<p><code>env</code> 列出系统所有环境变量；
<code>export</code> 只列出使用当前命令导出的环境变量；</p>
<h3 id="变量撤销-variable-revocation">变量撤销 Variable Revocation</h3>
<p><em><strong>可以使用 unset 来清除一个环境变量</strong></em></p>
<ul>
<li>Using unset command:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ A=B
$ B=C
$ unset $A
</code></pre></td></tr></table>
</div>
</div><p>上面这个例子将会撤销变量 <code>B</code></p>
<p>Different to null value:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">$ A=
$ unset A
</code></pre></td></tr></table>
</div>
</div><p>空变量和撤销一个变量是不同的概念；</p>
<h3 id="使用-read-指令定义变量-using-read">使用 read 指令定义变量 Using read</h3>
<ul>
<li>Geting variable values from STDIN: <code>$ read var1 var2 var3</code></li>
</ul>
<p>该命令可以从标注输入或者管道读取变量的值；</p>
<p>read 可以先声明需要读取那几个变量；</p>
<p>如果给定的值比定义的变量多的时候，根据 IFS 分割，每个一一对应，如果多出来的全部给最后一个变量；</p>
<p>如果不够那么未赋值的变量的初始值就是空值；</p>
<p>针对 quoting 只有反斜线才会生效；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[vagrant@localhost ~]$ read a b c
aaa\ bbb ccc
[vagrant@localhost ~]$ echo $c

[vagrant@localhost ~]$ echo $b
ccc
[vagrant@localhost ~]$ echo $a
aaa bbb
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Terminating input by pressing Enter</li>
</ul>
<p>在终端中输入完成之后按完 Enter 键之后就完成了输入</p>
<ul>
<li>
<p>Positional assignment</p>
<ul>
<li>Extras are assigned to the last variable</li>
</ul>
</li>
<li>
<p>Common options:</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 可以在键入值的终端给出一句提示语</span> 
-p <span class="s1">&#39; prompt&#39;</span> : gives prompts

<span class="c1"># 默认读取变量值是不限制长度的，使用该参数可以限定只会读取对应数值的字符</span> 
-n n : gets n of characters enough

<span class="c1"># 静音模式，即让用户输入的值变成不可见或者说不回显的</span> 
-s : silent mode
</code></pre></td></tr></table>
</div>
</div><ul>
<li>使用场景，在需要 shell 脚本临时暂停的时候可以使用该命令：</li>
</ul>
<p><img src="http://qiniu.jiiiiiin.cn/7P6ZjJ.jpg" alt="Text"></p>
<p>或者说，在执行脚本的过程中，需要用户交互式的键入一些变量值的场景；</p>
<h2 id="别名-command-alias">别名 Command Alias</h2>
<p>Setting an alias:</p>
<p><code>$ alias alias_name='commands line'</code></p>
<p>最好使用 quoting 来说明变量值；</p>
<p>Run defined commands by entering alias name.</p>
<p>User aliases are defined in <code>~/.bashrc</code></p>
<p>个人定义的别名建议定义在家目录的配置文件；</p>
<p>Listing aliases:</p>
<p><code>$ alias</code></p>
<p>Removing an alias:</p>
<p><code>$ unalias alias name</code></p>
<p>alias 也是区分进程范围的，即子进程取消别名，不会影响父进程，比如 bash；</p>
<p><em><strong>临时取消 alias，在指令前面打反斜线即可</strong></em> <code>\ls</code></p>
<ul>
<li>场景</li>
</ul>
<p>可以使用 <em><strong>alias</strong></em>用来设计常指令；</p>
<h2 id="进程的继承关系-process-hierarch">进程的继承关系 Process Hierarch</h2>
<ul>
<li>Every command generates a process when running</li>
<li>A command process is a child while the shell is the parent</li>
<li>A child process returns a value ( ? ) to parent when exists .</li>
</ul>
<p>每个进程在结束的时候都会送一个返回值给父进程；
在 shell 中使用<code>$?</code>即可查询最后一个进程结束返回的值；</p>
<h3 id="进程返回值">进程返回值</h3>
<p>在整个<em><strong>Return Value</strong></em>中只有两种状态，真和假；</p>
<p>真值为0；
假值为1~255；</p>
<p>在 shell 中能拿到的返回值就256个，只有0为真；</p>
<h2 id="shell-script定义">Shell Script定义</h2>
<p>Definition:</p>
<p>A series of command lines are predefined in a</p>
<p>text file for running.</p>
<p>脚本即按照写好的命令逐行执行；</p>
<h3 id="脚本运行方式">脚本运行方式</h3>
<p><img src="http://qiniu.jiiiiiin.cn/ORKZ7M.png" alt="Text"></p>
<p>运行脚本的第一种方式就是，给脚本赋予执行权限，之后在shell中指定脚本路径就可以执行（跑）这个脚本；</p>
<p>另外一种就是给定一个先决条件，指定bash，然后将路径作为对于bash的指定参数即可；</p>
<ul>
<li>Using a sub shell to run commands: Environment changing only effects the sub shell</li>
</ul>
<p>shell中执行一个脚本，很重要的一个概念就是，shell会作为父进程，创建一个<em><strong>sub-shell</strong></em>进程来跑脚本；</p>
<p>每一条命令的返回值是返回到sub-shell，最后的返回值（命令和子进程）一般都是最后一条命令的返回值；</p>
<p>sub-shell也可以定义自己的返回值，在脚本中；</p>
<p>定义方式<code>exit return_value</code>，即使用exit命令加上返回值；</p>
<ul>
<li>Interpreter is defined at the first line: <code>#!/path/to/shell</code></li>
</ul>
<p>shell脚本的第一行最佳实践都是需要声明脚本所编写的语境，即告诉shell怎么来翻译和执行这个脚本；</p>
<p><code>#!</code>加上绝对路径来限定使用那个解析器；</p>
<p>可以是任何类型的shell或者其他脚本语言的程序；</p>
<p>如果在shell脚本第一行没有声明解析器，那么就以当前跑脚本的shell的类型作为sub-shell；</p>
<p>所以为了避免脚本被错误的shell类型解析，最佳实践就是在第一行制定翻译官；</p>
<blockquote>
<p><a href="https://www.cnblogs.com/EasonJim/p/6850319.html">Linux脚本开头#!/bin/bash和#!/bin/sh是什么意思以及区别</a>
应该说，/bin/sh与/bin/bash虽然大体上没什么区别，但仍存在不同的标准。标记为#!/bin/sh的脚本不应使用任何POSIX没有规定的特性 (如let等命令, 但#!/bin/bash可以)。Debian曾经采用/bin/bash更改/bin/dash，目的使用更少的磁盘空间、提供较少的功能、获取更快的速度。但是后来经过shell脚本测试存在运行问题。因为原先在bash shell下可以运行的shell script (shell 脚本)，在/bin/sh下还是会出现一些意想不到的问题，不是100%的兼用。</p>
</blockquote>
<h3 id="source-命令来跑shell脚本-source-runing">Source 命令来跑shell脚本 Source Runing</h3>
<p><img src="http://qiniu.jiiiiiin.cn/iaSzfE.png" alt="Text"></p>
<p>Using source command to run script:</p>
<ul>
<li>
<p>There is no sub shell, interpreter is ignored.</p>
<p>这里就需要注意，因为没有sub-shell，所以如果脚本不是确切的shell类型，那么脚本在转译执行的时候肯定会出错；</p>
<p><em><strong>就算脚本第一行定义了翻译官程序，使用source执行的方式也不会看这行定义</strong></em>，就因为没有sub-shell导致的；</p>
<p><em><strong>执行source指令还可以使用 . 替代source</strong></em></p>
</li>
<li>
<p>Environment changing effects the current shell.</p>
<p>脚本如果修改了环境变量，将会影响到外部的shell本身；</p>
</li>
<li>
<p>常用于：</p>
<p>在linux中source是很常用的，比如我们定义一组环境变量，使用source之后，这些变量就在当前的shell中生效了；</p>
<p>可以理解为<em><strong>模块设计</strong></em>的概念；</p>
<p>类似一些语言中的import；</p>
</li>
</ul>
<h3 id="exec命令来跑-shell-脚本-exec-running">Exec命令来跑 shell 脚本 Exec Running</h3>
<p><img src="http://qiniu.jiiiiiin.cn/EDX8ZQ.png" alt="Text"></p>
<p>Using exec command to run script:</p>
<ul>
<li>
<p>The current shell is terminated at script starting.</p>
</li>
<li>
<p>The process is hanged over to interpreter.</p>
<p>结束当前的shell进程然后跑脚本；</p>
<p>当脚本跑完整个程序就结束了；</p>
</li>
</ul>
<h3 id="选择如何执行你的shell脚本">选择如何执行你的shell脚本</h3>
<ul>
<li>如果你希望跑完脚本要把脚本定义的环境（变量）继承过来就使用source来跑；</li>
<li>如果你希望跑完脚本不会影响环境（变量）那就使用正常的方式；</li>
<li>如果你希望跑完脚本（一般都会在结束时候移交到下一个shell进程）就结束当前shell就使用exec来执行；</li>
</ul>
<h3 id="示例">示例</h3>
<p>Write a simple shell script (my. Sh)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">pwd</span>
<span class="nb">cd</span> /tmp
<span class="nb">pwd</span>
sleep <span class="m">3</span>
</code></pre></td></tr></table>
</div>
</div><p>Make it executable</p>
<p><code>$ chmod +x my sh</code></p>
<p><img src="http://qiniu.jiiiiiin.cn/gB0Dz9.png" alt="Text"></p>
<p>上图使用了3中不同的方式来跑这个示例；</p>
<ol>
<li>
<p>使用正常方式，跑完之后执行pwd，发现当前shell环境没有被改变；</p>
</li>
<li>
<p>使用source方式，执行之后发现当前路径被修改了；</p>
</li>
<li>
<p><code>cd -</code> 先回到source之前的工作目录，使用exec的方式执行，执行完脚本之后，当前的shell进程将会终止；</p>
</li>
</ol>
<h3 id="排列成一行执行多行命令-sequence-running">排列成一行执行多行命令 Sequence Running</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">Using the: symbol S cmdl<span class="p">;</span> cmd2<span class="p">;</span> cmd3

Equivalent to

sss cmd1

cmd2

cmd <span class="m">3</span>
</code></pre></td></tr></table>
</div>
</div><p>可以使用分号来分割不同的命令，这样就可以按序/在一行执行完多个命令；</p>
<h2 id="命令行群组-command-grouping">命令行群组 Command Grouping</h2>
<p>Using {} to run command group in current shell:</p>
<p><code>{cmd1; cmd2; cmd3;}</code></p>
<p>大括号执行不会产生sub-shell；</p>
<p>Using  () to run command group in a nested sub shell:</p>
<p><code>(cmdl cmd2; cmd3)</code></p>
<p>圆括号会产生sub-shell；</p>
<p>这里的sub-shell就是上面source执行和正常执行的差别；</p>
<ul>
<li>Command Grouping Behavior</li>
</ul>
<p>Using {}:</p>
<p>Environment changing effects the current shell</p>
<p>Using  ():</p>
<p>Environment changing does NOT effects the current shell</p>
<h2 id="具名的群组-named-command-group">具名的群组 Named Command Group</h2>
<p>Also known as function</p>
<p>A command group is run when calling the function name</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ my_func <span class="o">(</span><span class="o">)</span> <span class="o">{</span>
&gt; cmd1<span class="p">;</span>
&gt; <span class="o">}</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ my_func
</code></pre></td></tr></table>
</div>
</div><p>如果但看大括号中的内容，就可以类比为上面的<em><strong>大括号命令群组</strong></em>;</p>
<p>这种写法就是给大括号命令群组一个命名；</p>
<p>执行的时候，只需要打名字就可以了；</p>
<p><em><strong>这种写法在shell script中就叫做funcation</strong></em></p>
<h2 id="命令替换-command-substitution">命令替换 Command Substitution</h2>
<p><img src="http://qiniu.jiiiiiin.cn/LlEM0y.png" alt="Text"></p>
<p>是将命令的执行结果抓出来，在重新组建新的命令；</p>
<p>和变量的替换不一样；</p>
<p>Using $ ():</p>
<p><code>$ cmd1 … $(cmd2 …) …</code></p>
<p>上面的执行流程是：</p>
<ol>
<li>先执行cmd2，结果会塞回到cmd1</li>
<li>再执行cmd1</li>
</ol>
<p>下面反引号这种是传统方式，不建议使用，在嵌套替换的时候很麻烦；</p>
<p>Usin``  (don’t be confused with ‘’):</p>
<p>$ cmd1 … `cmd2 …` …</p>
<p>上面这种做法是传统的方式，使用反引号</p>
<p>更准确的说应该是把命令的SDTOUT拿出来，SDTERR并不会导出来；</p>
<p>除非进行输出重定向；</p>
<p>如果是多层次的嵌套命令替换，那么会按出现的优先级来，但是最里面的肯定先会被替换；</p>
<ul>
<li>示例 1 使用日期指令进行推算</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">❯ cat 2.7-命令替换<span class="se">\(</span>下<span class="se">\)</span>/example_2.sh
<span class="c1">#!/bin/bash</span>
#

<span class="nb">echo</span> <span class="s2">&#34;</span><span class="s2">This year have passed </span><span class="k">$(</span>date +%j<span class="k">)</span><span class="s2"> days</span><span class="s2">&#34;</span>
<span class="nb">echo</span> <span class="s2">&#34;</span><span class="s2">This year have passed </span><span class="k">$((</span><span class="k">$(</span>date +%j<span class="k">)</span><span class="o">/</span><span class="m">7</span><span class="k">))</span><span class="s2"> weeks</span><span class="s2">&#34;</span>

<span class="nb">echo</span> <span class="s2">&#34;</span><span class="s2">There is </span><span class="k">$((</span><span class="m">365</span> <span class="o">-</span> <span class="k">$(</span>date +%j<span class="k">)</span><span class="k">))</span><span class="s2"> days before new year</span><span class="s2">&#34;</span>
<span class="nb">echo</span> <span class="s2">&#34;</span><span class="s2">There is </span><span class="k">$((</span><span class="o">(</span><span class="m">365</span> <span class="o">-</span> <span class="k">$(</span>date +%j<span class="k">)</span><span class="o">)</span><span class="o">/</span><span class="m">7</span><span class="k">))</span><span class="s2"> weeks before new year</span><span class="s2">&#34;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>示例 2 编写一个简单的 nginx 服务守护脚本</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">❯ cat 2.7-命令替换<span class="se">\(</span>下<span class="se">\)</span>/example_3.sh
<span class="c1">#!/bin/bash</span>
#

<span class="nv">nginx_process_num</span><span class="o">=</span><span class="k">$(</span>ps -ef <span class="p">|</span> grep nginx <span class="p">|</span> grep -v grep <span class="p">|</span> wc -l<span class="k">)</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$nginx_process_num</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
	systemctl start nginx
<span class="k">fi</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="其他变量替换-other-variable-substitution">其他变量替换 Other Variable Substitution</h3>
<h4 id="获取变量长度">获取变量长度</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="nv">$a</span>
haha
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">a</span><span class="si">}</span>
haha
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">a</span><span class="si">}</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${#</span><span class="nv">a</span><span class="si">}</span>
<span class="m">4</span>
</code></pre></td></tr></table>
</div>
</div><p>使用 <code>${#valiable_name}</code> 获取对于变量的长度；</p>
<p><img src="http://qiniu.jiiiiiin.cn/aqW274.png" alt="Text"></p>
<p><img src="http://qiniu.jiiiiiin.cn/Wc9FPS.png" alt="Text"></p>
<h4 id="获取子串在字符串中的索引位置">获取子串在字符串中的索引位置</h4>
<p><code>expr index $string $substring</code></p>
<h4 id="去头去尾">去头去尾</h4>
<p><img src="http://qiniu.jiiiiiin.cn/STME1k.png" alt=""></p>
<p>${var#pattern}</p>
<p>removes shortest pattern at beginning</p>
<p>${var##pattern}</p>
<p>removes longest pattern at beginning</p>
<p>${var%pattern)</p>
<p>removes shortest pattern at end</p>
<p>${var%%pattern}</p>
<p>removes longest pattern at end</p>
<p>变量替换使用的是$，那么其在键盘左边的就是去除满足patten的左边的值，即利用#;
而%则代表右边；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nv">y</span><span class="o">=</span>abc
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">y</span><span class="p">#ab</span><span class="si">}</span>
c
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">y</span><span class="p">%bc</span><span class="si">}</span>
a
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">y</span><span class="si">}</span>
abc
</code></pre></td></tr></table>
</div>
</div><p><img src="http://qiniu.jiiiiiin.cn/PI7I3Z.png" alt="Text">
<img src="http://qiniu.jiiiiiin.cn/xKM4Gx.png" alt="Text">
<img src="http://qiniu.jiiiiiin.cn/9IqoxC.png" alt="Text"></p>
<ul>
<li>示例：</li>
</ul>
<p>截取出路径中的文件名：</p>
<p><img src="http://qiniu.jiiiiiin.cn/4OeTZk.png" alt="Text"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 自留下文件名</span>
<span class="nb">echo</span> <span class="si">${</span><span class="nv">my_path</span><span class="p">##*/</span><span class="si">}</span>

<span class="c1"># 将绝对路径修改为相对</span>
<span class="nb">echo</span> <span class="si">${</span><span class="nv">my_path</span><span class="p">#/</span><span class="si">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这里的patten是路径匹配，参考shell路径匹配；</p>
<h4 id="截取子串">截取子串</h4>
<p><img src="http://qiniu.jiiiiiin.cn/8W6nF1.png" alt="Text"></p>
<h4 id="获取指定长度的变量值">获取指定长度的变量值</h4>
<p>${var: n: m}</p>
<p>To have m characters from position n （position starting from 0）</p>
<p>获取从n开始的m个字符；</p>
<h4 id="变量值输出内容替换">变量值输出内容替换</h4>
<p>${var/pattern/str} : substitutes the first pattern to str</p>
<p>${var//pattern/str}: substitutes all pattern to str</p>
<p><img src="http://qiniu.jiiiiiin.cn/dtWG3A.png" alt="Text"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">y</span><span class="p">//a/A</span><span class="si">}</span>
Abc
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">y</span><span class="si">}</span>
abc
</code></pre></td></tr></table>
</div>
</div><h2 id="数组-array-setting">数组 Array Setting</h2>
<p>Using  ():</p>
<p><code>array=(valuel value2 value3)</code></p>
<p>Position assignment:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">array <span class="o">[</span>0<span class="o">]</span> <span class="o">=</span>value1
array <span class="o">[</span>1<span class="o">]</span> <span class="o">=</span>value2 
array <span class="o">[</span>2<span class="o">]</span> <span class="o">=</span>value3
</code></pre></td></tr></table>
</div>
</div><p>数组有多个值，变量只有一个值；</p>
<ul>
<li>取值</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nv">b</span><span class="o">=</span><span class="o">(</span>a b c<span class="o">)</span>
<span class="c1"># @/* 都可以用来取出所有值</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">b</span><span class="p">[@]</span><span class="si">}</span>
a b c
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">b</span><span class="p">[*]</span><span class="si">}</span>
a b c
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">b</span><span class="p">[0]</span><span class="si">}</span>
a
<span class="c1"># 修改某个index对应的值</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ b<span class="o">[</span>0<span class="o">]</span><span class="o">=</span>haha
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">b</span><span class="p">[0]</span><span class="si">}</span>
haha
<span class="c1"># 取长度</span>
<span class="c1"># 取单个index对应值的长度</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${#</span><span class="nv">b</span><span class="p">[0]</span><span class="si">}</span>
<span class="m">4</span>
<span class="c1"># 取整个数组有多少个值</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="si">${#</span><span class="nv">b</span><span class="p">[@]</span><span class="si">}</span>
<span class="m">3</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="计算-arithmetic-expansion">计算 Arithmetic Expansion</h2>
<ul>
<li>
<p>32bit integer:</p>
<p>-2,147,483,648 to 2,147,483,647</p>
</li>
<li>
<p>No floating point !</p>
<p>Using external commands instead :</p>
<ul>
<li>bc</li>
<li>awk</li>
<li>perl</li>
</ul>
</li>
</ul>
<p>shell 目前只能处理整数；</p>
<h3 id="bc指令">bc指令</h3>
<p>bc是bash内建的运算器，支持浮点数运算</p>
<p>内建变量scale可以设置，默认为0，使用该参数可以将输出结果的小数点位数指定为对应位数，如：<code>echo &quot;scale=2;3/8&quot; | bc</code>;</p>
<p><img src="http://qiniu.jiiiiiin.cn/K9BjuC.png" alt="Text">
<img src="http://qiniu.jiiiiiin.cn/3CV0sf.png" alt="Text"></p>
<p>而小数的处理就只能依赖其他指令，如 bc；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nv">a</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s1">&#39;3.14*2&#39;</span> <span class="p">|</span> bc<span class="k">)</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="nv">$a</span>
6.28

<span class="c1"># 设定小数精度，scale=2标示保存两位小数</span>
<span class="nb">echo</span> <span class="s2">&#34;scale=2;3/8&#34;</span> <span class="p">|</span> bc
0.37
</code></pre></td></tr></table>
</div>
</div><h3 id="expr-指令">expr 指令</h3>
<p><img src="http://qiniu.jiiiiiin.cn/G19HoJ.png" alt="Text"></p>
<p><img src="http://qiniu.jiiiiiin.cn/0LRZHW.png" alt="Text"></p>
<p><img src="http://qiniu.jiiiiiin.cn/S6f9yg.png" alt="Text"></p>
<p>注意：</p>
<ul>
<li>操作符号左右必须要加空格；</li>
<li>在进行比较的时候，如果为真返回 1，这里和 shell 中执行命令如果执行成功返回 0
是反着的；</li>
</ul>
<p>技巧：</p>
<ul>
<li>判断一个数字是否是一个整数：</li>
</ul>
<p><img src="http://qiniu.jiiiiiin.cn/XsfYkq.png" alt="Text"></p>
<p>可以看到如果一个数字不是一个整数在进行 expr 相加的时候就会返回一个非 0 结果；</p>
<h3 id="运算符-arithmetic-operation">运算符 Arithmetic Operation</h3>
<p>Operators</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">+ add

- subtract

* multiply 

/ divide 

<span class="p">&amp;</span> AND 

<span class="p">|</span> OR

^ XOR

! NOT
</code></pre></td></tr></table>
</div>
</div><p>直接在shell中计算：</p>
<p>Using $ (()) or $ []:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nv">a</span><span class="o">=</span>5<span class="p">;</span> <span class="nv">b</span><span class="o">=</span>7<span class="p">;</span> <span class="nv">c</span><span class="o">=</span><span class="m">2</span>

$ <span class="nb">echo</span> $ <span class="o">(</span><span class="o">(</span>a+b*c<span class="o">)</span><span class="o">)</span>

<span class="m">19</span>

$ <span class="nb">echo</span> $ <span class="o">[</span><span class="o">(</span>a+b<span class="o">)</span> /c<span class="o">]</span>

<span class="m">6</span>
</code></pre></td></tr></table>
</div>
</div><p>需要注意因为shell不处理小数，由此如果除法得到一个小数，那么其实也仅仅现实整数，或者说除出来的一定是只能得到整数；</p>
<p>另外一种就是使用declare声明一个变量类型为整数：</p>
<p>Using declare with variable:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">declare</span> -i d
$ <span class="nv">d</span><span class="o">=</span> <span class="o">(</span>a+b<span class="o">)</span> /c
$ <span class="nb">echo</span> <span class="nv">$d</span>

<span class="m">6</span>
</code></pre></td></tr></table>
</div>
</div><p>如果在赋值给一个变量之前没有执行 <code>declare -i</code>那么整个变量得到的只会是一个算术表达式字符串；</p>
<p>也可以使用let直接定义一个变量：</p>
<p>Using let with variable</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">let</span> <span class="nv">f</span><span class="o">=</span> <span class="o">(</span>a+b<span class="o">)</span> /c
$ <span class="nb">echo</span> <span class="nv">$f</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>递增递减</li>
</ul>
<p>Using  (()) with variable</p>
<p>在for循环类的代码程序里面递增递减会被常用；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">$a</span><span class="o">=</span><span class="m">1</span>
<span class="k">$((</span>a++<span class="k">))</span>
<span class="nv">$echo</span> <span class="nv">$a</span>

<span class="m">2</span>

<span class="k">$((</span>a-<span class="o">=</span><span class="m">5</span><span class="k">))</span>
<span class="nv">$echo</span> <span class="nv">$a</span>

-3
</code></pre></td></tr></table>
</div>
</div><h2 id="脚本参数-script-parameter">脚本参数 Script Parameter</h2>
<ul>
<li>
<p>Assigned in command line</p>
<p>script_name par1 par2 par3 …</p>
<p>直接跟在执行脚本命令的后面；</p>
</li>
<li>
<p>Reset by set command</p>
<p>set par1 par2 par3 …</p>
<p>重设参数，在执行的脚本中使用 <code>set</code>；</p>
</li>
<li>
<p>Separated by  <!-- raw HTML omitted --></p>
<p>set &ldquo;par1par2”\ par3 …</p>
<p>设置参数是受控于 IFS的；</p>
<p>上面的示例等于只设置了一个参数；</p>
</li>
</ul>
<h3 id="参数取值-gathering-parameters">参数取值 Gathering Parameters</h3>
<ul>
<li>
<p>Substituted by $n (n=position) : $0 $1 $2 $3 …</p>
</li>
<li>
<p>Positions:</p>
<ul>
<li>
<p>$0 : script_ name itself</p>
<p>$0 在脚本中永远只会抓到script的名字，在function中也是如此；</p>
<p>但是在function中使用$n就是去函数自己的参数；</p>
</li>
<li>
<p>$1 : the 1st parameter</p>
</li>
<li>
<p>$2 : the 2nd parameter and SO on..</p>
</li>
</ul>
</li>
</ul>
<h2 id="参数替换-parameter-substitution">参数替换 Parameter Substitution</h2>
<ul>
<li>
<p>Reserved variables:</p>
<p>parameter内建替换变数</p>
<ul>
<li>
<p>$(nn] : position greater than 9</p>
</li>
<li>
<p>$# : the number of parameters</p>
<p>除了$0之外一共有多少个参数；</p>
<p>比如如果需要判断用户有没有传递参数到脚本就可以判断$#当前这个变量的长度，或者判断$1是否为空；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">  <span class="c1">#! /bin/bash</span>
  <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">||</span> <span class="o">{</span>
      <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$0</span><span class="s2"> : Error: miss params</span><span class="s2">&#34;</span><span class="p">;</span>
      <span class="nb">exit</span> 1<span class="p">;</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>$@ or $*  : All parameters individually</p>
</li>
<li>
<p>“$*” : All parameters in one</p>
</li>
<li>
<p>“$@“ : All parameters with position reserved</p>
<p>现实所有参数并维持原状；</p>
</li>
</ul>
</li>
<li>
<p>示例</p>
</li>
</ul>
<p>定义一个param.sh</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="cp">#! /bin/bash
</span><span class="cp"></span><span class="nb">echo</span> fieename: <span class="nv">$0</span>
<span class="nb">echo</span> <span class="nv">$1</span>
<span class="nb">echo</span> <span class="nv">$2</span>
<span class="nb">echo</span> <span class="nv">$3</span>


<span class="nb">echo</span> <span class="s1">&#39;$#: &#39;</span> <span class="nv">$#</span>
<span class="nb">echo</span> <span class="s1">&#39;$*: &#39;</span> <span class="nv">$*</span>
<span class="nb">echo</span> <span class="s1">&#39;&#34;$*&#34;: &#39;</span> <span class="s2">&#34;</span><span class="nv">$*</span><span class="s2">&#34;</span>
<span class="nb">echo</span> <span class="s1">&#39;&#34;$@&#34;: &#39;</span> <span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ ./param.sh <span class="s1">&#39;a b&#39;</span> c
./param.sh
a b
c

<span class="nv">$#</span>:  <span class="m">2</span>
<span class="c1"># 因为没有双引号所以就算传参的时候使用了quoting，但是三个字符 abc还是会被打散，虽然肉眼看不出来；</span>
<span class="nv">$*</span>:  a b c
<span class="c1"># 而下面这种情况，abc是合并成一个参数或者说字段回显的</span>
<span class="s2">&#34;</span><span class="nv">$*</span><span class="s2">&#34;</span>:  a b c
<span class="c1"># 这里就维持传参的quoting状态</span>
<span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span>:  a b c
</code></pre></td></tr></table>
</div>
</div><h2 id="参数变化-parameter-shifting">参数变化 Parameter Shifting</h2>
<p>删除前n个脚本参数；</p>
<ul>
<li>Using shift [n]</li>
<li>to erase the first n parameters,</li>
</ul>
<p>假设我们的脚本文件（test.sh）如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="cp">#!/usr/bin/env bash
</span><span class="cp"></span><span class="c1"># 显示前三个位置参数。</span>
<span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2"> </span><span class="nv">$2</span><span class="s2"> </span><span class="nv">$3</span><span class="s2">&#34;</span>
<span class="c1"># 移除前两个位置参数，并将$3重命名为$1，之后的以此类推。</span>
<span class="nb">shift</span> <span class="m">2</span>
<span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2"> </span><span class="nv">$2</span><span class="s2"> </span><span class="nv">$3</span><span class="s2">&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>在终端执行该脚本：</p>
<p>sh test.sh q w e r t</p>
<p>返回信息如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">q w e
e r t
</code></pre></td></tr></table>
</div>
</div><h2 id="重置参数-set-command">重置参数 Set Command</h2>
<p>可以使用set指令在脚本中重置参数；</p>
<p><img src="http://qiniu.jiiiiiin.cn/yJfOf8.jpg" alt="Text"></p>
<h2 id="脚本中的返回值-return-value-rv">脚本中的返回值 Return Value (RV)</h2>
<ul>
<li>
<p>Every command has a Return Value when exists, also called Exist Status.</p>
</li>
<li>
<p>Specified by exit in script:</p>
<p><code>exit [n]</code></p>
<p>Or, inherited from the last command</p>
<p>在调用端可以拿到整个返回值做一些条件判断；</p>
</li>
<li>
<p>Using $? to have RV of last command</p>
<p>使用<code>$?</code>获取返回值；</p>
</li>
<li>
<p>返回值的取值范围和进程的返回值一样；</p>
</li>
</ul>
<h2 id="条件返回-conditional-running">条件返回 Conditional Running</h2>
<ul>
<li>
<p>Using &amp;&amp; to run only while TRUE:
<code>cmd1 &amp;&amp; cmd2</code></p>
<ol>
<li>命令之间使用 &amp;&amp; 连接，实现逻辑与的功能。</li>
<li>只有在 &amp;&amp; 左边的命令返回真（命令返回值 $? == 0），&amp;&amp; 右边的命令才会被执行。</li>
<li>只要有一个命令返回假（命令返回值 $? == 1），后面的命令就不会被执行。</li>
</ol>
</li>
<li>
<p>Using ll to run only while FALSE:
<code>cmd1 || cmd2</code></p>
<ol>
<li>命令之间使用 || 连接，实现逻辑或的功能。</li>
<li>只有在 || 左边的命令返回假（命令返回值 $? == 1），|| 右边的命令才会被执行。这和 c 语言中的逻辑或语法功能相同，即实现短路逻辑或操作。</li>
<li>只要有一个命令返回真（命令返回值 $? == 0），后面的命令就不会被执行。
<em><strong>在.linux中的任何指令都有返回值</strong></em></li>
</ol>
</li>
</ul>
<h2 id="test-condition">Test Condition</h2>
<p>Using test command to return TRUE or FALSE accordingly:</p>
<ul>
<li>test expression</li>
<li>[ expression ]</li>
</ul>
<p>使用test指令或者表达式字面量来进行条件判断，返回真假值；</p>
<p>以上两种写法都可以；
注意使用中括号的时候，括号两边都必须要都空格；</p>
<h3 id="test-expression">Test Expression</h3>
<ul>
<li>
<p>( EXPRESSION )</p>
<p>EXPRESSION is true
使用括号来确定优先级；</p>
</li>
<li>
<p>! EXPRESSION</p>
<p>EXPRESSION is false</p>
</li>
<li>
<p>EXPRESSION1 -a EXPRESSION2</p>
<p>both EXPRESSION1 and EXPRESSION2 are true</p>
<p>-a就是and的意思，只有两个表达式同时成立，才会为真；</p>
</li>
<li>
<p>EXPRESSION1 -o EXPRESSION2</p>
<p>either EXPRESSION1 or EXPRESSION2 is true</p>
<p>只要有一个表达式为真就就返回真；</p>
</li>
<li>
<p>示例</p>
</li>
</ul>
<p>判断给定文件用户拥有那组权限：</p>
<p><img src="http://qiniu.jiiiiiin.cn/QrYoJK.png" alt="Text"></p>
<p><img src="http://qiniu.jiiiiiin.cn/2Ob7EH.png" alt="Text"></p>
<p>递归的判断给定参数是否是文件：</p>
<p><img src="http://qiniu.jiiiiiin.cn/XV8Snl.png" alt="Text"></p>
<p>表达式的内容只能有一下3中类型：String Expression/Integer Expression</p>
<h3 id="string-expression">String Expression</h3>
<ul>
<li>
<p>-n STRING</p>
<p>the length of STRING is nonzero</p>
</li>
<li>
<p>STRING equivalent to -n STRING</p>
<p>上面两种是一样的意思；</p>
<p>意思是字串的长度为非零的时候为真；</p>
<p>非空字串为真，空字串为假值；</p>
</li>
</ul>
<h4 id="例子-test-example">例子 Test Example</h4>
<p>Think about</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">unset</span> A
$ <span class="nb">test</span> -n <span class="nv">$A</span>
$ <span class="nb">echo</span> <span class="nv">$?</span>
<span class="m">0</span>

<span class="c1"># 0 就是真，因为在翻译之后真正执行的test指令是 `test -n` 后面不接任何参数，那么-n在这里就不是选项而是args；因为 -n 是两个字串所以结果为真；</span>

$ <span class="nb">test</span> -n <span class="s2">&#34;</span><span class="nv">$A</span><span class="s2">&#34;</span>
<span class="c1"># 双引号内的解析得到一个预留的空字符串；</span>
$ <span class="nb">echo</span> <span class="nv">$?</span>
<span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>-z STRING</p>
<p>the length of STRING is zero</p>
<p>当碰到空串为真；</p>
</li>
<li>
<p>STRING1 = STRING2</p>
<p>the strings are equal</p>
<p>字串相同为真；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nv">A</span><span class="o">=</span><span class="s2">&#34;a&#34;</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nv">B</span><span class="o">=</span><span class="s2">&#34;c&#34;</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$A</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$B</span><span class="s2">&#34;</span> <span class="o">]</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="nv">$?</span>
<span class="m">1</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nv">B</span><span class="o">=</span><span class="s2">&#34;a&#34;</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$A</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$B</span><span class="s2">&#34;</span> <span class="o">]</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ <span class="nb">echo</span> <span class="nv">$?</span>
<span class="m">0</span>
</code></pre></td></tr></table>
</div>
</div><p>最好在进行比较的时候将变量进行quoting；</p>
</li>
<li>
<p>STRING1 != STRING2</p>
<p>the strings are not equal</p>
<p>字串不相同为真；</p>
</li>
</ul>
<h3 id="integer-expression">Integer Expression</h3>
<p>只能对比整数，需要对比小数需要使用类似bc这样的程序；</p>
<ul>
<li>
<p>INTEGER1 -eq INTEGER2</p>
<p>INTEGER1 is equal to INTEGER2</p>
</li>
<li>
<p>INTERGER1 -ge INTEGER2</p>
<p>INTERGER1 is greater than or equal to INTEGER2</p>
</li>
<li>
<p>INTERGER1 -gt INTEGER2</p>
<p>INTEGERl is greater than INTEGER2</p>
</li>
<li>
<p>INTERGER1 -le INTEGER2</p>
<p>INTEGERl is less than or equal to INTEGER2</p>
</li>
<li>
<p>INTEGER1 -lt INTEGER2</p>
<p>INTEGER1 is less than INTEGER2</p>
</li>
<li>
<p>INTEGER1 -ne INTEGER2</p>
<p>INTEGER1 is not equal to INTEGER2</p>
</li>
</ul>
<h3 id="file-expression">File expression</h3>
<p>_+ FILE1 -nt FIle2</p>
<pre><code>FILE1 is newer (mtime)than FILE2

左边的文档是否比右边要新；
</code></pre>
<p>_+ FILE1 -ot FIlE2</p>
<pre><code>FILE1 is older than FIle2
</code></pre>
<blockquote>
<p><a href="https://www.slideshare.net/kennychennetman/linux-fundamental-chap-14-shell-script">更多选项</a></p>
</blockquote>
<h2 id="条件分之判断-the-if-then-statement">条件分之判断 The if-then Statement</h2>
<p>Syntax:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="k">if</span> cmd1
<span class="k">then</span>
    cmd2 …
<span class="k">fi</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="k">if</span> <span class="o">[</span> хххх <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    cmd2
<span class="k">fi</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="k">if</span> cmd1
<span class="k">then</span>
    cmd2 ...
<span class="k">else</span>
    cmd3 ...
<span class="k">fi</span>
</code></pre></td></tr></table>
</div>
</div><p>else语句必须要声明then；</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="k">if</span> cmd1
<span class="k">then</span>
    <span class="c1"># : 标示空命令永远返回真</span>
    :
<span class="k">else</span>
    cmd3 ...
<span class="k">fi</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="using-command-group">Using Command Group</h3>
<p>Syntax:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">cmd1 <span class="o">&amp;&amp;</span> <span class="o">{</span>
    cmd2 …
    <span class="c1"># 注意这里必须做一个返回真的写法，避免群组中的命令执行返回假，cmd3被执行，就不是if else 条件语句的预期</span>
    :
<span class="o">}</span>  <span class="o">||</span>  <span class="o">{</span>
    cmd3 …
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="多轮条件判断-multiple-conditions-elif">多轮条件判断 Multiple Conditions (elif)</h3>
<blockquote>
<p><img src="http://qiniu.jiiiiiin.cn/8ASYYZ.png" alt="Text"></p>
</blockquote>
<p>如果第一个if条件没有执行，就会判断第二轮 elif的条件判断语句，如果第一个if块被执行（条件为真），那么就不走第二轮；</p>
<p>类似swich语句；</p>
<h2 id="case判断语法-run-by-case">Case判断语法 Run By case</h2>
<p>Syntax:</p>
<p><img src="http://qiniu.jiiiiiin.cn/iAQXX6.png" alt="Text"></p>
<p>可以用于比较的包括整数/字符串/文档；</p>
<p><img src="http://qiniu.jiiiiiin.cn/Vfry6E.png" alt="Text"></p>
<p>使用*号来兜底，在上面的case都不满足的情况下执行；</p>
<p><img src="http://qiniu.jiiiiiin.cn/hUTfXP.png" alt="Text"></p>
<p><img src="http://qiniu.jiiiiiin.cn/JhFFx5.png" alt="Text"></p>
<p>可以使用｜线来添加单个case的符合条件值；</p>
<ul>
<li>示例</li>
</ul>
<p>定义一个让用户输入 yes 确认的方法：</p>
<p><img src="http://qiniu.jiiiiiin.cn/rs76SB.png" alt="Text"></p>
<h2 id="循环语句-loop-statement">循环语句 Loop Statement</h2>
<p>Loop flow:</p>
<p><img src="http://qiniu.jiiiiiin.cn/vSbMaL.png" alt="Text"></p>
<h3 id="the-for-loop">The for Loop</h3>
<p>Syntax:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="k">for</span> VAR in values …
<span class="k">do</span> 
	commands 
<span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div><p>for 后面可以定义一个变量；</p>
<p>in后面就是这个变量的值；</p>
<p>do &hellip; done 中间就是循环的内容；</p>
<p>值的个数决定循环的次数；</p>
<p>在循环里面可以使用 <code>$VAR</code> 获取循环中迭代的值；</p>
<p><img src="http://qiniu.jiiiiiin.cn/36X62Z.png" alt="Text"></p>
<p>Tips:</p>
<ul>
<li>A new variable is set when running a for loop</li>
<li>The value sources are vary.</li>
<li>The times of loop depends on the number of value.</li>
<li>Each value is used once in the do一 done statement in order.</li>
</ul>
<h3 id="the-while-loop">The while Loop</h3>
<p>Syntax:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="k">while</span> cmd1 
<span class="k">do</span>
	cmd2 …
<span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div><p>while 后面为真，do done中的内容就会循环执行；</p>
<p>Tips:</p>
<ul>
<li>The cmd1 is run at each loop cycle.</li>
<li>The do一done statement only be run while cmd1 returns TRUE value.</li>
<li>The whole loop is terminated once cmd1 returns FALSE value.</li>
<li>Infinity loop may be designed in purpose, or accidentally,</li>
</ul>
<p><img src="http://qiniu.jiiiiiin.cn/EL4juw.png" alt="Text"></p>
<h3 id="break">break</h3>
<p><img src="http://qiniu.jiiiiiin.cn/8ovZNy.png" alt="Text"></p>
<p>Tips:</p>
<ul>
<li>The loop is terminated once the break runs</li>
<li>A number can be specified to break the Nth outbound loop.</li>
</ul>
<p><img src="http://qiniu.jiiiiiin.cn/spXCRh.png" alt="Text"></p>
<p>break 可以选择跳脱出那层循环，默认是<code>break 1</code>,上面的图中可以使用<code>break 3</code>跳出最外层循环；</p>
<p><img src="http://qiniu.jiiiiiin.cn/GtwT9O.png" alt="Text"></p>
<p>也支持 continue，切 <code>continue n</code>即为跳出第几层的当次循环；</p>
<h4 id="using-cont-inue-in-loop">Using cont inue In Loop</h4>
<p>Tips:</p>
<ul>
<li>The remained lines in current loop cycle are omitted once the continue runs, script goes straight to continue next cycle.</li>
<li>A number can be specified to continue the Nth outbound loop.</li>
</ul>
<p><img src="http://qiniu.jiiiiiin.cn/f5AFwu.png" alt="Text"></p>
<h2 id="函数-function">函数 Function</h2>
<ul>
<li>
<p>Linux Shell中的函数和大多数编程语言中的函数一样</p>
</li>
<li>
<p>将相似的任务或代码封装到函数中，供其他地方调用.</p>
</li>
</ul>
<p>语法：</p>
<p><img src="http://qiniu.jiiiiiin.cn/mN2wTT.png" alt="Text"></p>
<p><img src="http://qiniu.jiiiiiin.cn/6ZcPAr.png" alt="Text"></p>
<ul>
<li>
<p>直接使用函数名调用，可以将其想象成Shell中的一条命令</p>
</li>
<li>
<p>函数内部可以直接使用参数$1、$2&hellip; $n</p>
</li>
<li>
<p>调用函数： function name $1 $2</p>
</li>
<li>
<p>参数传递</p>
</li>
</ul>
<p><img src="http://qiniu.jiiiiiin.cn/ZnDCnC.png" alt="Text">
<img src="http://qiniu.jiiiiiin.cn/WKyUxF.png" alt="Text"></p>
<ul>
<li>返回值</li>
</ul>
<p><img src="http://qiniu.jiiiiiin.cn/L5huYk.png" alt="Text"></p>
<ul>
<li>使用return返回值，只能返回1一255的整数</li>
<li>函数使用return返回值，通常只是用来供其他地方调用获取状态，因此通常仅返回0或1 ； 0表示成功， 1表示失败</li>
<li>默认 return 返回的是 0；</li>
<li>使用echo返回值
<ul>
<li>使用echo可以返回任何字符串结果</li>
<li>通常用于返回数据，比如一个字符串值或者列表值</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>#

<span class="k">function</span> get_users
<span class="o">{</span>
	<span class="nv">users</span><span class="o">=</span><span class="sb">`</span>cat /etc/passwd <span class="p">|</span> cut -d: -f1<span class="sb">`</span>
	<span class="nb">echo</span> <span class="nv">$users</span>
<span class="o">}</span>

<span class="nv">user_list</span><span class="o">=</span><span class="sb">`</span>get_users<span class="sb">`</span>

<span class="nv">index</span><span class="o">=</span><span class="m">1</span>
<span class="k">for</span> u in <span class="nv">$user_list</span>
<span class="k">do</span>
	<span class="nb">echo</span> <span class="s2">&#34;</span><span class="s2">The </span><span class="nv">$index</span><span class="s2"> user is : </span><span class="nv">$u</span><span class="s2">&#34;</span>
	<span class="nv">index</span><span class="o">=</span><span class="k">$((</span><span class="nv">$index</span><span class="o">+</span><span class="m">1</span><span class="k">))</span>
<span class="k">done</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="调试脚本">调试脚本</h2>
<p><img src="http://qiniu.jiiiiiin.cn/ONnsUD.png" alt="Text"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"> <span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ bash -x ./param.sh
+ <span class="s1">&#39;[&#39;</span> <span class="s1">&#39;&#39;</span> <span class="s1">&#39;]&#39;</span>
+ show_error
+ <span class="nb">echo</span> <span class="s1">&#39;./param.sh : Error: miss params&#39;</span>
./param.sh : Error: miss params
+ show_usage
+ <span class="nb">echo</span> Usage:
Usage:
+ <span class="nb">echo</span> -e <span class="s1">&#39;\t./param.sh file&#39;</span>
	./param.sh file
+ sleep <span class="m">5</span>
+ <span class="nb">exit</span> <span class="m">1</span>
<span class="o">[</span>vagrant@localhost ~<span class="o">]</span>$ cat ./param.sh
<span class="c1">#! /bin/bash</span>
show_usage <span class="o">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="nb">echo</span> Usage:
    <span class="nb">echo</span> -e <span class="s2">&#34;</span><span class="s2">\t</span><span class="nv">$0</span><span class="s2"> file</span><span class="s2">&#34;</span>
    sleep <span class="m">5</span>
<span class="o">}</span>
show_error <span class="o">(</span><span class="o">)</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$0</span><span class="s2"> : Error: miss params</span><span class="s2">&#34;</span><span class="p">;</span>
<span class="o">}</span>
<span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">]</span> <span class="o">||</span> <span class="o">{</span>
    show_error
    show_usage
    <span class="nb">exit</span> 1<span class="p">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>-x 回显进程执行流程</li>
</ul>
<p>sh 的选项：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">-c string：命令从-c后的字符串读取。
-i：实现脚本交互。
-n：进行shell脚本的语法检查。
-x：实现shell脚本逐条语句的跟踪。
</code></pre></td></tr></table>
</div>
</div><p>这里可以使用-x 来查看脚本的执行情况。</p>
<p><img src="http://qiniu.jiiiiiin.cn/E1aDYW.png" alt="Text"></p>
<h2 id="示例脚本">示例脚本</h2>
<ul>
<li>将当前脚本执行的进程排查掉 grep 的判断语句</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="cp">#!/bin/bash
</span><span class="cp"></span>#

<span class="c1"># 获取当前脚本执行进程的 pid</span>
<span class="nv">this_pid</span><span class="o">=</span><span class="nv">$$</span>

<span class="k">while</span> <span class="nb">true</span>
<span class="k">do</span>
ps -ef <span class="p">|</span> grep nginx <span class="p">|</span> grep -v grep <span class="p">|</span> grep -v <span class="nv">$this_pid</span> <span class="p">&amp;</span>&gt; /dev/null

<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
	<span class="nb">echo</span> <span class="s2">&#34;Nginx is running well&#34;</span>
	sleep <span class="m">3</span>
<span class="k">else</span>
	systemctl start nginx
	<span class="nb">echo</span> <span class="s2">&#34;Nginx is down,Start it....&#34;</span>
<span class="k">fi</span>
<span class="k">done</span>

</code></pre></td></tr></table>
</div>
</div><p>上面 ps 执行的一句中 grep -v $$ 就可以排除掉当前脚本运行的进程的干扰，避免脚本名称和 grep 的条件产生冲突；</p>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">赵津</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2020-05-24
        <a href="https://github.com/Jiiiiiin/hugo-note/commit/d6deae8cc4e33a69440e9da674f30f4cd650d2a5" title="修改笔记">(d6deae8)</a>
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/linux/">linux</a>
          <a href="/tags/shell-script/">shell-script</a>
          </div>
      <nav class="post-nav" style="height: 100px">
        
        
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:yn.zhaojun@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/Jiiiiiin/Jiiiiiin.github.io" class="iconfont icon-github" title="github"></a>
  <a href="http://localhost:1313/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">赵津</span>
  </span>
  <a href="http://www.beian.miit.gov.cn" target="_blank"><span>滇ICP备 16004781号</span></a>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>








</body>
</html>
